[package]
name = "gpuix-native"
version = "0.1.0"
edition = "2021"
description = "GPUI bindings for Node.js via napi-rs"
license = "Apache-2.0"

[lib]
crate-type = ["cdylib", "rlib"]

[dependencies]
napi = { version = "2", features = ["napi8", "serde-json"] }
napi-derive = "2"
serde = { version = "1", features = ["derive"] }
serde_json = "1"
anyhow = "1"
log = "0.4"
env_logger = "0.11"
parking_lot = "0.12"
pollster = "0.4"
raw-window-handle = "0.6"
uuid = { version = "1", features = ["v4"] }
futures = "0.3"

# GPUI and related crates from Zed at the "GPUI on the web" commit
# This commit adds Application::with_platform() and makes Platform trait public
gpui = { git = "https://github.com/zed-industries/zed", rev = "14f37ed5024bbccff2200797d1d9bf69aee01d66" }
gpui_wgpu = { git = "https://github.com/zed-industries/zed", rev = "14f37ed5024bbccff2200797d1d9bf69aee01d66" }

# wgpu for pre-creating Metal-capable instance (gpui_wgpu defaults to VULKAN|GL only)
wgpu = "28.0"

# winit for native window creation with pump_events() support (non-blocking)
winit = "0.30"

# macOS text/graphics deps - pinned to avoid core-graphics version conflicts
# core-text 21.1.0 uses core-graphics 0.25 which conflicts with font-kit's core-graphics 0.24
[target.'cfg(target_os = "macos")'.dependencies]
core-text = "=21.0.0"
core-graphics = "=0.24.0"
# objc2 for NSApplication activation (bring window to foreground from Node.js)
objc2 = "0.5"
objc2-foundation = { version = "0.2", features = ["NSThread"] }
objc2-app-kit = { version = "0.2", features = ["NSApplication", "NSRunningApplication", "NSWindow", "NSResponder"] }
# gpui_macos for real Metal rendering in visual test renderer (VisualTestAppContext)
gpui_macos = { git = "https://github.com/zed-industries/zed", rev = "14f37ed5024bbccff2200797d1d9bf69aee01d66" }

[features]
default = ["test-support"]
test-support = ["gpui/test-support"]

[build-dependencies]
napi-build = "2"

[[example]]
name = "hello"
path = "examples/hello.rs"

[profile.release]
lto = true
